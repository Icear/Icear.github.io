<!DOCTYPE html>
<html lang="cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.swordandfire.online","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Icear&#39;s blog">
<meta property="og:url" content="https://blog.swordandfire.online/index.html">
<meta property="og:site_name" content="Icear&#39;s blog">
<meta property="og:locale">
<meta property="article:author" content="Icear">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.swordandfire.online/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'cn'
  };
</script>

  <title>Icear's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Icear's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Icear's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/05/13/veth-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/13/veth-introduction/" class="post-title-link" itemprop="url">Veth</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-13 19:11:00 / Modified: 19:05:00" itemprop="dateCreated datePublished" datetime="2022-05-13T19:11:00+08:00">2022-05-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Veth"><a href="#Veth" class="headerlink" title="Veth"></a>Veth</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Veth 是 Linux Kernel 中提供的一套虚拟网络设备接口，顾名思义为虚拟网络设备，通过在 Kennel 中注册虚拟网络设备并交付给其它应用使用，能够用来向其它服务（如容器）提供解耦式的网络代理功能。目前的 Docker 及 K8s 网络实现中均使用此方式来为容器提供网络服务。</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>Veth 在申请时为成对出现，申请的应用程序会同时获得一对网络设备，拥有不同的设备名称，两个设备默认关联。可以向其中一个设备发送网络数据包，此时数据包会经过 Kernel 的转发从另一端的 Veth 网络设备中接收，反向通信同理。</p>
<p>进阶用法可以将 Veth 设备的一端绑定至物理网口或其它设备上进行使用。</p>
<h2 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h2><p>对于容器中采用此特性的实现，能够很好地为容器模拟真实主机的运行环境，内核能够通过标准网络通信接口为容器提供服务，而 runtime 可以接管容器的网络通信并且在其上做各种协议封装过滤等功能，效果很好。</p>
<p>此特性由内核提供，当内核本身成为瓶颈时这种通信方式则会遭遇瓶颈。由于内核转发需要在内核态与用户态间切换，存在一定的开销，需要进一步获得更高性能时可以考虑内核旁路模式执行，如 [[OVN]]、DPDK等实现。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/04/09/obsidian-plugins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/09/obsidian-plugins/" class="post-title-link" itemprop="url">Obsidian插件使用记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-09 19:10:00" itemprop="dateCreated datePublished" datetime="2022-04-09T19:10:00+08:00">2022-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-13 18:54:00" itemprop="dateModified" datetime="2022-05-13T18:54:00+08:00">2022-05-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Obsidian插件使用记录"><a href="#Obsidian插件使用记录" class="headerlink" title="Obsidian插件使用记录"></a>Obsidian插件使用记录</h1><h2 id="开端"><a href="#开端" class="headerlink" title="开端"></a>开端</h2><p>之前配置Obsidian的时候搜罗了很多各种各样的插件，不得不说Obsidian的插件生态真的好到起飞，这里列出自己使用或遇到过比较有用的插件，一方面是做一个记录方面以后查找，另一方面也回顾一下自己都安了哪些乱七八糟的插件（笑）。</p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>下面每个插件的标题均为Obsidian市场中的插件名，可以直接通过名称搜索到对应的插件。</p>
<h3 id="Admonition"><a href="#Admonition" class="headerlink" title="Admonition"></a>Admonition</h3><p>富文本扩展插件，能够在markdown中嵌入块样式的附加文字，从而与正文分开，可以用于填写增加一些评论、旁注、警告或追加醒目信息等功能。</p>
<p>平时用得不是很多，因为开始要自己配置admonition的名字，比较不开箱即用，可能还要探索一阵。</p>
<h3 id="Advanced-Table"><a href="#Advanced-Table" class="headerlink" title="Advanced Table"></a>Advanced Table</h3><p>表格功能增强插件，支持快速调整表格格式样式居中居右等功能，插件启动后会在左侧按钮列表中增加一个入口，点击后会在右侧打开控制panal使用。</p>
<p>实际上现在用表格比较少，所以暂时没用上。</p>
<h3 id="Auto-Link-Title"><a href="#Auto-Link-Title" class="headerlink" title="Auto Link Title"></a>Auto Link Title</h3><p>增强URL功能插件，在粘贴URL到markdown中的时候自动切换成URL语法并且访问原地址获取网页标题填写到语句中，很方便。</p>
<h3 id="Calendar"><a href="#Calendar" class="headerlink" title="Calendar"></a>Calendar</h3><p>日历插件，能够在右侧日历面板（不确定是不是插件提供的）上为每个日子创建一个markdown文件，支持从模板创建并且展示一些信息到日历上快速索引。</p>
<p>是一个比较核心的插件，编辑模板以后可以做很多事情，比如说当每天的事件总结和起始事件，这样每天都等于有一个工作总结或者开端，不过有点尴尬就是这两个作用混在一起的话只有一个模板文件会难受一些，可能起始页这件事应该拆分到其它地方去。还有点麻烦的事情就是这个模板也不是开箱即用的，所以模板上需要自己花费很多精力去慢慢调整，如果能直接毛些别人的模板就好了hhh。</p>
<h3 id="Checklist"><a href="#Checklist" class="headerlink" title="Checklist"></a>Checklist</h3><p>Todo功能的扩展插件，功能是在右侧面板中提供一个Todo List面板，把各个markdown文件中的Todo事项全部列在一起，顺便还是彩色展示。</p>
<p>之前完全没意识到安装了这个插件，效果上Todo展示的效果非常直观，可以直接完成和开始任务，不过不确定这个完成时间能不能触发其它插件的时间记录，可能要测试一番，如果可以的话联动效果就非常好了。</p>
<h3 id="Cycle-Through-Panes"><a href="#Cycle-Through-Panes" class="headerlink" title="Cycle Through Panes"></a>Cycle Through Panes</h3><p>让你可以使用<code>ctrl + tab</code> 的方式在多个文档间切换，<code>ctrl + shift + tab</code>是反向切换。</p>
<h3 id="Dataview"><a href="#Dataview" class="headerlink" title="Dataview"></a>Dataview</h3><p>可以说是Obsidian的杀手级插件之一了，赋予了Obsidian数据检索能力，能够把Markdown文件当作数据库来进行检索，支持多种SQL语法，并且也支持使用Javascript语法来编写查询逻辑，拥有极强的可玩性。</p>
<p>DataView本身还会为每个Markdown文件追加诸多元数据和追踪信息用于检索，从而提供更多可操作信息。</p>
<p>配合模板可以做到快速扫描Vault展示各种各样的信息，非常好用，强力推荐。</p>
<h3 id="Day-Planer"><a href="#Day-Planer" class="headerlink" title="Day Planer"></a>Day Planer</h3><p>扩展插件，可以将Todo按时间线形式列出，因此能够用来安排日常规划，拥有一个面板来展示信息。</p>
<h3 id="Editor-Syntax-Highlight"><a href="#Editor-Syntax-Highlight" class="headerlink" title="Editor Syntax Highlight"></a>Editor Syntax Highlight</h3><p>给markdown中代码块提供语法高亮功能。</p>
<h3 id="Find-Unlinked-Files"><a href="#Find-Unlinked-Files" class="headerlink" title="Find Unlinked Files"></a>Find Unlinked Files</h3><p>查找vault中没有link或被link的文档，方便生成知识网络管理，触发方式是在command中使用<code>find unlinked file</code>。</p>
<p>暂时没有用过，可以用来偶尔查漏补缺一下以前拉下的笔记。</p>
<h3 id="Incremental-Writing"><a href="#Incremental-Writing" class="headerlink" title="Incremental Writing"></a>Incremental Writing</h3><p>笔记管理插件，可以配置把笔记分成多个工作队列，从而完成多层流的笔记处理。</p>
<p>常见的可以把笔记放在未完成队列中这样每次可以补全笔记，更高深的用法可以是把笔记分成初次记录，后期文档化和标签化等多个队列，多个工作流一步步吸收归纳知识。</p>
<p>高级用法暂时没有使用过，目前暂时还是当作未完成队列在使用，因为这个模式是开箱即用的。</p>
<h3 id="Kanban"><a href="#Kanban" class="headerlink" title="Kanban"></a>Kanban</h3><p>将Markdown文件转化为看板，可以设置不同的工作条，但是具体的展示效果暂时没有测试过。</p>
<p>拿类似的独立产品Trello来说，Trello的进度条功能和拖动是非常好用的功能，如果没有这两个功能的话它对我的吸引力就没有那么大了，虽然做到了多合一但是牺牲了直观性。</p>
<h3 id="Obsidian-Linter"><a href="#Obsidian-Linter" class="headerlink" title="Obsidian Linter"></a>Obsidian Linter</h3><p>Markdown格式化工具，默认配置和Vscode类似都是在保存时自动进行格式化，有很多具体格式细节能够调整，并且支持自动插入一些YAML Tag，配合文档索引等功能非常方便。</p>
<h3 id="Media-Extended"><a href="#Media-Extended" class="headerlink" title="Media Extended"></a>Media Extended</h3><p>让Markdown支持播放音频及视频，并且支持定位到指定的时间轴位置。</p>
<p>具体效果因为未使用过暂时未知，目前预想到的场景为看网课视频时做笔记能够快速索引到原文，或是在看视频作评论时能够使用。</p>
<p>扩展插件：Media Extended for Bilibili，大概是这样的名字，能够在插件市场中搜索到，顾名思义是为哔哩哔哩视频提供了引用支持。</p>
<h3 id="Mind-Map"><a href="#Mind-Map" class="headerlink" title="Mind Map"></a>Mind Map</h3><p>将Markdown文档按标题顺序生成对应的脑图，某种程度上能够成为脑图绘制工具，或是在编写一份笔记时用来纵览思路，使用场景很多。</p>
<p>使用时通过command调出对应panel即可，可以放置在一旁作为速览。</p>
<p>使用上插件有时候会因为部分皮肤和主题之类的原因无法显示，兼容性相对比较差，使用时可能要和主题作一番取舍。</p>
<h3 id="Natural-Language-Dates"><a href="#Natural-Language-Dates" class="headerlink" title="Natural Language Dates"></a>Natural Language Dates</h3><p>通过<code>@</code>符号加today、tomorrow等关键词快速插入当前日期，属于快捷语法一类的插件，但是某些高级功能插件需要依赖这个插件功能运作，因此也属于必备插件之一。</p>
<h3 id="Obsidian-Charts"><a href="#Obsidian-Charts" class="headerlink" title="Obsidian-Charts"></a>Obsidian-Charts</h3><p>在Markdown中插入好看的图表，使用方式可以通过<code>Chart</code>代码块创建或command呼叫图形化图表生成。</p>
<p>这个插件暂时没有使用过，不知道能不能配合dataview的数据检索进行操作，如果可以的话也将是一个非常好用的功能插件。</p>
<h3 id="Obsidian-Outliner"><a href="#Obsidian-Outliner" class="headerlink" title="Obsidian Outliner"></a>Obsidian Outliner</h3><p>为markdown的list提供额外的快捷键控制，类似其它的markdown软件中快捷键，便于list的操控。</p>
<h3 id="Pandoc-Plugn"><a href="#Pandoc-Plugn" class="headerlink" title="Pandoc Plugn"></a>Pandoc Plugn</h3><p>为Obsidian提供Pandoc支持，本身不带Pandoc组件需要自行安装，主要功能是提供word、html、latex、markdown等格式的导出，PDF导出功能已经由Obsidian官方支持并且兼容的功能更多，Pandoc主要是为其它场景使用。</p>
<p>安装后在command中调用即可。</p>
<h3 id="Reminder"><a href="#Reminder" class="headerlink" title="Reminder"></a>Reminder</h3><p>为markdown的Todo提供时间提醒功能，在Todo上标记时间即可触发，有一个独立面板按时间展示Todo，同时兼容Kanban插件和其它Task插件的语法，组合以后Obsidian在Todo追踪这一块功能就非常完整了。</p>
<p>目前暂时没有在使用，Todo功能虽然很全但是跨平台方面我还没有配置好，所以没有迁移过来，并且快速添加Todo会相对麻烦一些。</p>
<h3 id="Self-hosted-LiveSync"><a href="#Self-hosted-LiveSync" class="headerlink" title="Self-hosted LiveSync"></a>Self-hosted LiveSync</h3><p>为Obsidian开启第三方兼容的实时同步功能，让Obsidian能够完全本地化运行，目前官方表示插件已经接近稳定但是可能还有数据损坏可能，此外它仅能用于同步而不是一个备份方案。</p>
<p>这个插件是刚发现不久的，并没有实际使用过，从功能目的上来说非常未来可期。</p>
<h3 id="Sliding-Panes"><a href="#Sliding-Panes" class="headerlink" title="Sliding Panes"></a>Sliding Panes</h3><p>将Obsidian在多个文档间跳转的行为变成叠加多个panel，方便阅读时在多个文档间快速切换，非常方便。</p>
<h3 id="Tasks"><a href="#Tasks" class="headerlink" title="Tasks"></a>Tasks</h3><p>Obsidian的Todo管理增强插件，为Todo增加了日期时间、循环定时、完成时间记录等功能，让Obsidian可以作为一个比较完整的Tasks管理软件运作。</p>
<p>目前使用上还好，编辑时要配置Todo需要用command进行控制稍微有点麻烦，可能这里还有其它优化方式我没有发现，另外它对完成时间的标记能够被DataView识别，从而做到联动效果，这点非常方便，但是似乎DataView自身也能够对Todo的数据进行追踪，这部分可能需要再作尝试。</p>
<h3 id="Templater"><a href="#Templater" class="headerlink" title="Templater"></a>Templater</h3><p>Obsidian的模板增强插件，支持众多插件语法和快速创建命令，支持按目录匹配模板等，此处功能介绍可以参考其官方的介绍，是Obsidian的核心扩展插件之一，很多管理技巧都可以通过它的模板功能实现。</p>
<h3 id="Text-Expand"><a href="#Text-Expand" class="headerlink" title="Text Expand"></a>Text Expand</h3><p>Markdown语法扩展插件，可以在Markdown中对Vault内数据进行搜索并展示，只要预先设定搜索条件和规则即可。</p>
<p>这个插件之前安装后没有意识到它的存在，没有使用过，但是这种动态能力应该具有非常高的可玩性。</p>
<h3 id="Vault-Statistics"><a href="#Vault-Statistics" class="headerlink" title="Vault Statistics"></a>Vault Statistics</h3><p>为Obsidian增加词数统计等功能，增强统计效果，算是基础插件之一，统计信息也是文档类编辑工具的基础能力了。</p>
<h3 id="Workbench"><a href="#Workbench" class="headerlink" title="Workbench"></a>Workbench</h3><p>这个插件在安装后也没有使用过，其功能描述为能够将当前UI中显示的信息（Todos、Block、段落等）生成链接插入到另一个已打开的Markdown文档之中，生成链接后在该文档里会直接显示成正文并且能够编辑和操作。</p>
<p>这个的作用似乎局限于已经打开的文档中？引用功能的话类似的插件还挺多的，不知道它的作用如何。</p>
<h3 id="Youglsih-Plugin"><a href="#Youglsih-Plugin" class="headerlink" title="Youglsih Plugin"></a>Youglsih Plugin</h3><p>一个词典插件，能够快速给出某个词的定义和用例，甚至能够定位到相关网络视频（主要是油管）的发音用例，值得一提的是这个插件并不局限于英语。</p>
<p>词典功能很完善，有点奇怪的是我觉得Obsidian这个编辑器的功能有点差异，作为一个输入软件能够被查询的词可能用户不太能够直接输入到文档中，而能够输入到文档中的词通常也不需要进行查询，除非用户主动把未知的词汇粘贴进Obsidian来使用这个功能。</p>
<p>更理想的场景应该是放置到浏览器之类的输出软件因为那里用户能够接触到不了解的词汇从而进行词典查询，要在Obsidian里进行未知词汇查询就比较奇怪。这个插件也没有使用过。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/03/22/mellanox-asap2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/22/mellanox-asap2/" class="post-title-link" itemprop="url">Mellanox ASAP2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-22 17:14:00" itemprop="dateCreated datePublished" datetime="2022-03-22T17:14:00+08:00">2022-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-13 18:05:00" itemprop="dateModified" datetime="2022-05-13T18:05:00+08:00">2022-05-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Mellanox-ASAP2"><a href="#Mellanox-ASAP2" class="headerlink" title="Mellanox ASAP2"></a>Mellanox ASAP2</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Accelerated Switching and Packet Processing</p>
<p>加速交换与数据报处理技术，原由Mellanox提出但在Nvidia收购后更名为 Nvidia ASAP2</p>
<h2 id="应对场景"><a href="#应对场景" class="headerlink" title="应对场景"></a>应对场景</h2><p>主要针对高速网络下的加速网络数据包场景，传统网络数据包处理需要将网络通信数据包全部提交至CPU进行处理，这些处理过程占用了CPU资源并且开销日益增大</p>
<h2 id="应对思路"><a href="#应对思路" class="headerlink" title="应对思路"></a>应对思路</h2><p>让网卡接管网络IO的处理，并且在硬件上完成原本CPU需要进行的网络数据解析任务，并且携带网络数据分流的特性，支持Single Root Virtualization等方式模拟出多个网络设备，将不同的网络流量分别呈递，能够接入[[OpenVirtualSwitch]] 虚拟交换或其它虚拟网络，使得这一过程对CPU的开销降低到非常低的程度，从而达到硬件加速的效果</p>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Benchmarks show that on a server with a 25G interface, OVS accelerated by ASAP2 Direct achieves 33 million packets per second (mpps) for a single flow with near-zero CPU cores consumed by the OVS data plane, and about 18 mpps with 60,000 flows performing VXLAN encap/decap. These performance results are three to ten times higher than DPDK-accelerated OVS. ASAP2 offers the best of both worlds, software-defined flexible network programmability, and high network I/O performance for the state-of-art speeds from 10G to 25/40/50/100/200G.</span><br></pre></td></tr></table></figure>

<p>25G 端口下，通过<code>ASAP2 Direct</code> 技术能够处理单条流33mpps数据包，且无CPU占用，在<code>VXLAN</code>解包生成包操作下能够达到最多6万条流一共18mpps的性能</p>
<p>目前此技术可应用在25&#x2F;40&#x2F;50&#x2F;100&#x2F;200G网络通信模式中</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://network.nvidia.com/pdf/products/SB_asap2.pdf">https://network.nvidia.com/pdf/products/SB_asap2.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/display/MLNXENv493150/OVS+Offload+Using+ASAP2+Direct">OVS Offload Using ASAP2 Direct - MLNX_EN v4.9-3.1.5.0 LTS - NVIDIA Networking Docs</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/03/09/wsl2-53-dns-port-in-use-resolution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/09/wsl2-53-dns-port-in-use-resolution/" class="post-title-link" itemprop="url">WSL2占用53端口的解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-09 22:22:00 / Modified: 22:03:00" itemprop="dateCreated datePublished" datetime="2022-03-09T22:22:00+08:00">2022-03-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="WSL2占用53端口的解决方案"><a href="#WSL2占用53端口的解决方案" class="headerlink" title="WSL2占用53端口的解决方案"></a>WSL2占用53端口的解决方案</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>[[WSL]]2在运行时由于为虚拟机架构，因此与宿主机的网络通信实际上为两块虚拟网卡之间相互通信，为了让WSL2子系统能够正常访问网络，其在初始化时会在宿主机53端口上开启一个DNS解析服务，并且由于虚拟网卡的IP端不固定，会随着每次系统的重启而变化，因此该解析服务监听了<code>0.0.0.0:53</code>，由此导致了在WSL2运行时，用户无法自行运行53端口的DNS解析服务。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>实际上该DNS解析服务范围为<code>0.0.0.0:53</code>，即IPv4空间，而IPv6空间下53端口为空闲状态，因此用户自行启用的53服务设定去监听IPv6即可，并且Windows主机支持只设定ipv6的DNS，且v6下的DNS也可以解析v4的IP</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/microsoft/WSL/issues/4364">WslRegisterDistribution failed with error: 0xffffffff · Issue #4364 · microsoft&#x2F;WSL · GitHub</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/03/09/dpdk-environment-setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/09/dpdk-environment-setup/" class="post-title-link" itemprop="url">DPDK 环境搭建记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-09 14:37:00" itemprop="dateCreated datePublished" datetime="2022-03-09T14:37:00+08:00">2022-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-13 13:04:00" itemprop="dateModified" datetime="2022-04-13T13:04:00+08:00">2022-04-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DPDK环境搭建记录"><a href="#DPDK环境搭建记录" class="headerlink" title="DPDK环境搭建记录"></a>DPDK环境搭建记录</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>由Intel发起的开源网络数据处理框架及相关生态环境，本身面向更通用化的数据平面编程，并且在和Intel硬件的结合后能够有更好的运行性能（如DPDK在Intel CPU及Intel NIC环境中，数据包在到达NIC后能够直接上传至CPU的三级缓存中，相比其他PF_RING等框架为NIC通过DMA上传至系统内存，这种优化能够减少一次CPU读取内存的操作）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对大多数平台，使用基本DPDK功能无需对BIOS进行特殊设置。然而，对于HPET定时器和电源管理功能，以及为了获得40G网卡上小包处理的高性能，则可能需要更改BIOS设置。可以参阅章节  [Enabling Additional Functionality](https://doc.dpdk.org/guides/linux_gsg/enable_func.html#enabling-additional-functionality)以获取更为详细的信息。</span><br></pre></td></tr></table></figure>

<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h3><ul>
<li><p>General development tools including a supported C compiler such as gcc (version 4.9+) or clang (version 3.4+), and <code>pkg-config</code>  or <code>pkgconf</code> to be used when building end-user binaries against DPDK.</p>
<ul>
<li><p>For RHEL&#x2F;Fedora systems these can be installed using</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf groupinstall &quot;Development  Tools&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>For Ubuntu&#x2F;Debian systems these can be installed using</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install build-essential</span><br></pre></td></tr></table></figure>
</li>
<li><p>For Alpine Linux</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add alpine-sdk bsd-compat-headers libexecinfo-dev</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Python 3.5 or later.</p>
</li>
<li><p>Meson (version 0.49.2+) and ninja</p>
<ul>
<li><code>meson</code>  &amp;  <code>ninja-build</code>  packages in most Linux distributions</li>
<li>If the packaged version is below the minimum version, the latest versions can be installed from Python’s “pip” repository: <code>pip3 install meson ninja</code></li>
</ul>
</li>
<li><p><code>pyelftools</code>  (version 0.22+)</p>
<ul>
<li>For Fedora systems it can be installed using  <code>dnf install python-pyelftools</code></li>
<li>For RHEL&#x2F;CentOS systems it can be installed using <code>pip3 install pyelftools</code></li>
<li>For Ubuntu&#x2F;Debian it can be installed using  <code>apt install python3-pyelftools</code></li>
<li>For Alpine Linux,  <code>apk add py3-elftools</code></li>
</ul>
</li>
<li><p>Library for handling NUMA (Non Uniform Memory Access).</p>
<ul>
<li><code>numactl-devel</code>  in RHEL&#x2F;Fedora;</li>
<li><code>libnuma-dev</code>  in Debian&#x2F;Ubuntu;</li>
<li><code>numactl-dev</code>  in Alpine Linux</li>
</ul>
</li>
</ul>
<h4 id="Optional-Tools"><a href="#Optional-Tools" class="headerlink" title="Optional Tools"></a>Optional Tools</h4><ul>
<li>Intel® C++ Compiler (icc). For installation, additional libraries may be required. See the icc Installation Guide found in the Documentation directory under the compiler installation.</li>
<li>IBM® Advance ToolChain for Powerlinux. This is a set of open source development tools and runtime libraries which allows users to take leading edge advantage of IBM’s latest POWER hardware features on Linux. To install it, see the IBM official installation document.</li>
</ul>
<h4 id="Additional-Libraries"><a href="#Additional-Libraries" class="headerlink" title="Additional Libraries"></a>Additional Libraries</h4><p> A number of DPDK components, such as libraries and poll-mode drivers (PMDs) have additional dependencies. For DPDK builds, the presence or absence of these dependencies will be automatically detected enabling or disabling the relevant components appropriately.</p>
<p>In each case, the relevant library development package (  -devel or  -dev  ) is needed to build the DPDK components.</p>
<p>For libraries the additional dependencies include:</p>
<ul>
<li>libarchive: for some unit tests using tar to get their resources.</li>
<li>libelf: to compile and use the bpf library.</li>
</ul>
<p>For poll-mode drivers, the additional dependencies for each driver can be found in that driver’s documentation in the relevant DPDK guide document, e.g. <a target="_blank" rel="noopener" href="https://doc.dpdk.org/guides/nics/index.html">Network Interface Controller Drivers — Data Plane Development Kit 22.03.0 documentation</a></p>
<h4 id="System-Software"><a href="#System-Software" class="headerlink" title="System Software"></a>System Software</h4><p><strong>Required:</strong></p>
<ul>
<li><p>Kernel version &gt;&#x3D; 4.4</p>
<p>  The kernel version required is based on the oldest long term stable kernel available at kernel.org when the DPDK version is in development. Compatibility for recent distribution kernels will be kept, notably RHEL&#x2F;CentOS 7.</p>
<p>  The kernel version in use can be checked using the command:</p>
<p>  uname -r</p>
</li>
<li><p>glibc &gt;&#x3D; 2.7 (for features related to cpuset)</p>
<p>  The version can be checked using the <code>ldd --version</code> command.</p>
</li>
<li><p>Kernel configuration</p>
<p>  In the Fedora OS and other common distributions, such as Ubuntu, or Red Hat Enterprise Linux, the vendor supplied kernel configurations can be used to run most DPDK applications.</p>
<p>  For other kernel builds, options which should be enabled for DPDK include:</p>
<ul>
<li>HUGETLBFS</li>
<li>PROC_PAGE_MONITOR support</li>
<li>HPET and HPET_MMAP configuration options should also be enabled if HPET support is required. See the section on <a target="_blank" rel="noopener" href="https://doc.dpdk.org/guides/linux_gsg/enable_func.html#high-precision-event-timer">High Precision Event Timer (HPET) Functionality</a> for more details.</li>
</ul>
</li>
</ul>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><h4 id="下载源代码并解压"><a href="#下载源代码并解压" class="headerlink" title="下载源代码并解压"></a>下载源代码并解压</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xJf dpdk-&lt;version&gt;.tar.xz</span><br><span class="line">cd dpdk-&lt;version&gt;</span><br></pre></td></tr></table></figure>

<p>The DPDK is composed of several directories, including:</p>
<ul>
<li>doc: DPDK Documentation</li>
<li>license: DPDK license information</li>
<li>lib: Source code of DPDK libraries</li>
<li>drivers: Source code of DPDK poll-mode drivers</li>
<li>app: Source code of DPDK applications (automatic tests)</li>
<li>examples: Source code of DPDK application examples</li>
<li>config, buildtools: Framework-related scripts and configuration</li>
<li>usertools: Utility scripts for end-users of DPDK applications</li>
<li>devtools: Scripts for use by DPDK developers</li>
<li>kernel: Kernel modules needed for some operating systems</li>
</ul>
<h4 id="DPDK-Configuration"><a href="#DPDK-Configuration" class="headerlink" title="DPDK Configuration"></a>DPDK Configuration</h4><p>To configure a DPDK build use:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meson &lt;options&gt; build</span><br></pre></td></tr></table></figure>

<p>where “build” is the desired output build directory, and <code>&lt;options&gt;</code> can be empty or one of a number of meson or DPDK-specific build options, described later in this section. The configuration process will finish with a summary of what DPDK libraries and drivers are to be built and installed, and for each item disabled, a reason why that is the case. This information can be used, for example, to identify any missing required packages for a driver.</p>
<p>Once configured, to build and then install DPDK system-wide use:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd build</span><br><span class="line">ninja</span><br><span class="line">ninja install</span><br><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<p>The last two commands above generally need to be run as root, with the ninja install step copying the built objects to their final system-wide locations, and the last step causing the dynamic loader ld.so to update its cache to take account of the new objects.</p>
<h3 id="配置网卡驱动"><a href="#配置网卡驱动" class="headerlink" title="配置网卡驱动"></a>配置网卡驱动</h3><p>DPDK使用PMD驱动操作网卡，并且有多个可选项，默认使用 <code>UIO</code> or <code>VFIO</code>驱动，但是也能够基于<a target="_blank" rel="noopener" href="https://doc.dpdk.org/guides/linux_gsg/linux_drivers.html#bifurcated-driver">Bifurcated Driver</a> 运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is recommended that `vfio-pci` be used as the kernel module for DPDK-bound ports in all cases. If an IOMMU is unavailable, the `vfio-pci` can be used in [no-iommu](https://doc.dpdk.org/guides/linux_gsg/linux_drivers.html#vfio-noiommu) mode. If, for some reason, vfio is unavailable, then UIO-based modules, `igb_uio` and `uio_pci_generic` may be used. See section [UIO](https://doc.dpdk.org/guides/linux_gsg/linux_drivers.html#uio) for details.</span><br></pre></td></tr></table></figure>

<p>大部分设备被DPDK使用时，需要将其脱离Linux Kernel的控制，这意味着Linux Kernel将无法看到该设备并管理，<strong>其它非DPDK应用程序在Kernel重新获得控制权之前也无法使用该设备。对于网络设备可以基于端口进行分割绑定</strong></p>
<p>操作设备绑定与解绑，DPDK提供一个实用脚本 <code>dpdk-devbind.py</code> 可使用</p>
<ul>
<li><p>查看系统中网络端口状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">./usertools/dpdk-devbind.py --status</span><br><span class="line"></span><br><span class="line">Network devices using DPDK-compatible driver</span><br><span class="line">============================================</span><br><span class="line">0000:82:00.0 &#x27;82599EB 10-GbE NIC&#x27; drv=vfio-pci unused=ixgbe</span><br><span class="line">0000:82:00.1 &#x27;82599EB 10-GbE NIC&#x27; drv=vfio-pci unused=ixgbe</span><br><span class="line"></span><br><span class="line">Network devices using kernel driver</span><br><span class="line">===================================</span><br><span class="line">0000:04:00.0 &#x27;I350 1-GbE NIC&#x27; if=em0  drv=igb unused=vfio-pci *Active*</span><br><span class="line">0000:04:00.1 &#x27;I350 1-GbE NIC&#x27; if=eth1 drv=igb unused=vfio-pci</span><br><span class="line">0000:04:00.2 &#x27;I350 1-GbE NIC&#x27; if=eth2 drv=igb unused=vfio-pci</span><br><span class="line">0000:04:00.3 &#x27;I350 1-GbE NIC&#x27; if=eth3 drv=igb unused=vfio-pci</span><br><span class="line"></span><br><span class="line">Other network devices</span><br><span class="line">=====================</span><br><span class="line">&lt;none&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>绑定设备“04：00.1”到驱动vfio-pci</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./usertools/dpdk-devbind.py --bind=vfio-pci 04:00.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line">./usertools/dpdk-devbind.py --bind=vfio-pci eth1</span><br></pre></td></tr></table></figure>
</li>
<li><p>释放设备到系统，即切换其驱动到标准驱动，支持通配符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./usertools/dpdk-devbind.py --bind=ixgbe 82:00.*</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="VFIO-驱动相关"><a href="#VFIO-驱动相关" class="headerlink" title="VFIO 驱动相关"></a>VFIO 驱动相关</h4><p>默认情况下，<code>VFIO 驱动</code> 通常已集成在系统中，能够直接启用运行</p>
<p>通过前述提到的 <code>dpdk-devbind.py</code> 能够将设备切换到 <code>VFIO驱动</code> 中</p>
<p>部分情况下使用脚本将设备绑定到 <code>VFIO驱动</code> </p>
<h2 id="开发DPDK应用"><a href="#开发DPDK应用" class="headerlink" title="开发DPDK应用"></a>开发DPDK应用</h2><h3 id="编译环境配置"><a href="#编译环境配置" class="headerlink" title="编译环境配置"></a>编译环境配置</h3><p>When installed system-wide, DPDK provides a pkg-config file <code>libdpdk.pc</code> for applications to query as part of their build. It’s recommended that the pkg-config file be used, rather than hard-coding the parameters (cflags&#x2F;ldflags) for DPDK into the application build process.</p>
<p>An example of how to query and use the pkg-config file can be found in the <code>Makefile</code> of each of the example applications included with DPDK. A simplified example snippet is shown below, where the target binary name has been stored in the variable <code>$(APP)</code> and the sources for that build are stored in <code>$(SRCS-y)</code>.</p>
<p>PKGCONF &#x3D; pkg-config</p>
<p>CFLAGS +&#x3D; -O3 $(shell $(PKGCONF) –cflags libdpdk)</p>
<p>LDFLAGS +&#x3D; $(shell $(PKGCONF) –libs libdpdk)</p>
<p>$(APP): $(SRCS-y) Makefile<br>        $(CC) $(CFLAGS) $(SRCS-y) -o $@ $(LDFLAGS)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unlike with the make build system present in older DPDK releases, the meson system is not designed to be used directly from a build directory. Instead it is recommended that it be installed either system-wide or to a known location in the user’s home directory. The install location can be set using the –prefix meson option (default: /usr/local).</span><br></pre></td></tr></table></figure>

<p>an equivalent build recipe for a simple DPDK application using meson as a build system is shown below:</p>
<p>project(‘dpdk-app’, ‘c’)</p>
<p>dpdk &#x3D; dependency(‘libdpdk’)</p>
<p>sources &#x3D; files(‘main.c’)</p>
<p>executable(‘dpdk-app’, sources, dependencies: dpdk)</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/allcloud/p/7723305.html">Linux平台上DPDK入门指南 - allcloud - 博客园</a></li>
<li><a target="_blank" rel="noopener" href="https://doc.dpdk.org/guides/linux_gsg/build_dpdk.html">3. Compiling the DPDK Target from Source — Data Plane Development Kit 22.03.0 documentation</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/03/08/dataview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/08/dataview/" class="post-title-link" itemprop="url">DataView 插件介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-08 14:55:00" itemprop="dateCreated datePublished" datetime="2022-03-08T14:55:00+08:00">2022-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-13 17:34:00" itemprop="dateModified" datetime="2022-05-13T17:34:00+08:00">2022-05-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DataView-插件介绍"><a href="#DataView-插件介绍" class="headerlink" title="DataView 插件介绍"></a>DataView 插件介绍</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>[[Obsidian]]插件之一，能够将Obsidian内的文档视为数据表进行检索和数据处理。</p>
<h2 id="数据可识别格式"><a href="#数据可识别格式" class="headerlink" title="数据可识别格式"></a>数据可识别格式</h2><h3 id="YAML格式"><a href="#YAML格式" class="headerlink" title="YAML格式"></a>YAML格式</h3><p>在Markdown文件中嵌入YAML格式的字段，能够被识别为数据</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#markdown content</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="section">#yaml content</span></span><br><span class="line">name1: dataContent1</span><br><span class="line">name2: dataContent2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Markdown格式"><a href="#Markdown格式" class="headerlink" title="Markdown格式"></a>Markdown格式</h3><p>在Markdown文件中使用<code>Name::Value</code>的方式标记数据</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#markdown content</span></span><br><span class="line"></span><br><span class="line">name1::dataContent1</span><br><span class="line">name2::dataContent2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="插件追加信息"><a href="#插件追加信息" class="headerlink" title="插件追加信息"></a>插件追加信息</h3><p>dataview插件本身也会为Markdown文件加入诸多标记属性，这里使用一个打印命令将本文件的属性全部输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dv.paragraph(dv.current())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="检索语法"><a href="#检索语法" class="headerlink" title="检索语法"></a>检索语法</h2><h3 id="块检索语法"><a href="#块检索语法" class="headerlink" title="块检索语法"></a>块检索语法</h3><p>使用语法标记为dataview的代码块进行检索，在其中输入检索语句进行查询</p>
<p>检索语法可参考SQL语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;columns&gt;</span><br><span class="line">FROM &lt;source&gt;</span><br><span class="line">WHERE &lt;condition&gt;</span><br><span class="line">SORT &lt;column&gt; [desc|asc]</span><br><span class="line">GROUP BY &lt;column&gt;</span><br></pre></td></tr></table></figure>

<h4 id="SELECT-对应的关键词"><a href="#SELECT-对应的关键词" class="headerlink" title="SELECT 对应的关键词"></a><code>SELECT</code> 对应的关键词</h4><ul>
<li>LIST 以列表的形式展示数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LIST</span><br><span class="line">FROM &lt;source&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>TABLE 以表格的形式展示数据，语法后接字段，表示定义</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TABLE column1, column2, column3</span><br><span class="line">FROM &lt;source&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>TASK 以任务形式展示数据，与LIST类似但是能够将抽出的数据作为任务生成</li>
</ul>
<h4 id="FROM-语法"><a href="#FROM-语法" class="headerlink" title="FROM 语法"></a><code>FROM</code> 语法</h4><p>FROM 可以从 <code>#tag</code> 标签获取、 从 <code>folder</code> 文件夹获取、从 <code>[[link]]</code> 链接获取，或者从链接了 link 的文件获取 <code>outgoing([[link]])</code></p>
<h3 id="行内代码语法"><a href="#行内代码语法" class="headerlink" title="行内代码语法"></a>行内代码语法</h3><p>Dataview 目前支持的行内代码块主要是对于日期以及本页信息的显示，例如：</p>
<h3 id="显示时间差"><a href="#显示时间差" class="headerlink" title="显示时间差"></a>显示时间差</h3><p>你可以用行内代码块计算出任意的时间差，如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`=(date(2021-12-31)-date(today))`</span><br></pre></td></tr></table></figure>

<p>你就可以获得相关的时间差值，如下：</p>
<p><img src="https://pic2.zhimg.com/80/v2-51e6e5d6aa72e711292f0ef6cdff7de5_1440w.jpg"></p>
<h3 id="查看当前文件的信息"><a href="#查看当前文件的信息" class="headerlink" title="查看当前文件的信息"></a>查看当前文件的信息</h3><p>例如标签：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`= this.file.tags`</span><br></pre></td></tr></table></figure>

<p>进入渲染模式后就会自动在对应的位置上显示你的当前文件的所有标签了。</p>
<h2 id="DataviewJS-代码块"><a href="#DataviewJS-代码块" class="headerlink" title="DataviewJS 代码块"></a>DataviewJS 代码块</h2><p>正如它后边附带的 JS 所言，DataviewJS 在扩展了本身的函数能力的基础上，获得了所有 API 相关的操作权限以及几乎完全的 Javascript 能力。接下来先介绍 DataviewJS 已经封装好的几个主要显示函数（目前仅能通过这些函数来显示对应的参数）。</p>
<p>注意，DataviewJS 代码块用 dataviewjs 而不是 dataview</p>
<p>DataviewJS语法也可在inline中使用，使用prefix <code>$=</code>即可触发，<strong>缺陷为目前无法在live preview模式下触发，需要切换到reading模式</strong></p>
<h3 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h3><ul>
<li><code>dv.pages(source)</code></li>
</ul>
<p>根据标签或者文件夹返回页面参数，代码参考如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">dv.pages(&quot;#books&quot;) //返回所有带有标签 books 的页面</span><br><span class="line">dv.pages(&#x27;&quot;folder&quot;&#x27;) //返回所有在 folder 文件夹的页面</span><br><span class="line">dv.pages(&quot;#yes or -#no&quot;) //返回所有带有标签 yes 或者没有标签 no 的页面</span><br><span class="line">dv.pages(&quot;&quot;) //返回所有页面</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<ul>
<li><code>dv.pagePaths(source)</code></li>
</ul>
<p>和上边类似，但是这个会返回文件路径作为参数</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">dv.pagePaths(&quot;#books&quot;) //返回所有带有标签 books 的页面路径</span><br><span class="line">dv.pagePaths(&#x27;&quot;folder&quot;&#x27;) //返回所有在 folder 文件夹的页面路径</span><br><span class="line">dv.pagePaths(&quot;#yes or -#no&quot;) //返回所有带有标签 yes 或者没有标签 no 的页面路径</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<ul>
<li><code>dv.page(path)</code></li>
</ul>
<p>用于返回单个页面作为参数</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">dv.page(&quot;Index&quot;) //返回名称为 Index 的页面</span><br><span class="line">dv.page(&quot;books/The Raisin.md&quot;) //返回所有在 books 文件夹下的 The Raisin 文件的页面</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h3><ul>
<li><code>dv.header(level, text)</code></li>
</ul>
<p>用于渲染特定的文本为标题，其中 level 为层级，text 为文本。</p>
<ul>
<li><code>dv.paragraph(text)</code></li>
</ul>
<p>用于渲染为段落，你可以理解成普通文本。</p>
<h3 id="Dataview-封装函数"><a href="#Dataview-封装函数" class="headerlink" title="Dataview 封装函数"></a>Dataview 封装函数</h3><h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">dv.list([1, 2, 3]) //生成一个1，2，3的列表</span><br><span class="line">dv.list(dv.pages().file.name)  //生成所有文件的文件名列表</span><br><span class="line">dv.list(dv.pages().file.link)  //生成所有文件的文件链接列表，即双链</span><br><span class="line">dv.list(dv.pages(&quot;&quot;).file.tags.distinct()) //生成所有标签的列表</span><br><span class="line">dv.list(dv.pages(&quot;#book&quot;).where(p =&gt; p.rating &gt; 7)) //生成在标签 book 内所有评分大于 7 的书本列表</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a>任务列表</h3><p>默认为 <code>dv.taskList(tasks, groupByFile)</code> 其中任务需要用上文获取 <code>pages</code> 后，再用 <code>pages.file.tasks</code> 来获取，例如 <code>dv.pages(&quot;#project&quot;).file.tasks</code>。 而当 groupByFile 为 True 或者 1 的时候，会按照文件名分组。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 从所有带有标签 project 的页面中获取所有的任务生成列表</span><br><span class="line">dv.taskList(dv.pages(&quot;#project&quot;).file.tasks)</span><br><span class="line"></span><br><span class="line">// 从所有带有标签 project 的页面中获取所有的未完成任务生成列表</span><br><span class="line">dv.taskList(dv.pages(&quot;#project&quot;).file.tasks</span><br><span class="line">    .where(t =&gt; !t.completed))</span><br><span class="line"></span><br><span class="line">// 从所有带有标签 project 的页面中获取所有的带有特定字符的任务生成列表</span><br><span class="line">// 可以设置为特定日期</span><br><span class="line">dv.taskList(dv.pages(&quot;#project&quot;).file.tasks</span><br><span class="line">    .where(t =&gt; t.text.includes(&quot;#tag&quot;)))</span><br><span class="line"></span><br><span class="line">// 将所有未完成且带有字符串的任务列出</span><br><span class="line">dv.taskList(</span><br><span class="line">    dv.pages(&quot;&quot;).file.tasks</span><br><span class="line">    .where(t =&gt; t.text.includes(&quot;#todo&quot;) &amp;&amp; !t.completed),1)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><p>默认为 <code>dv.table(headers, elements)</code> ，提供表头和元素内容即可生成对应的表格。</p>
<p>例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 根据标签 book 对应的页面的 YAML 生成一个简单的表格，其中 map 为对应的内容所对应的表头，按顺序填入即可。</span><br><span class="line">// b 可以是任意值，只是代表当前传入的文件为 b</span><br><span class="line">dv.table([&quot;File&quot;, &quot;Genre&quot;, &quot;Time Read&quot;, &quot;Rating&quot;], dv.pages(&quot;#book&quot;)</span><br><span class="line">    .sort(b =&gt; b.rating)</span><br><span class="line">    .map(b =&gt; [b.file.link, b.genre, b[&quot;time-read&quot;], b.rating]))</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p>看完以上的内容以后，如果你对表格或者获取的数据操作感兴趣的话，那你应该去查看官方提供的数据操作 API ，请查阅：<a href="https://link.zhihu.com/?target=https://blacksmithgu.github.io/obsidian-dataview/docs/api/data-array">Data Arrays | Dataview</a></p>
<hr>
<h2 id="DataviewJS-示例"><a href="#DataviewJS-示例" class="headerlink" title="DataviewJS 示例"></a>DataviewJS 示例</h2><p>以下的方案目前已经经过一部分人的使用，大呼已经满足，而如果你还有其它的需求的话，可以去请教对 Javascript 熟悉的人，或者去官方论坛请教。此处感谢提供脚本的 @tzhou 以及在官方社区的 @shabegom</p>
<h3 id="标签聚合"><a href="#标签聚合" class="headerlink" title="标签聚合"></a>标签聚合</h3><h3 id="简单版"><a href="#简单版" class="headerlink" title="简单版"></a>简单版</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 生成所有的标签且形成列表</span><br><span class="line">dv.list(dv.pages(&quot;&quot;).file.tags.distinct())</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="改进版"><a href="#改进版" class="headerlink" title="改进版"></a>改进版</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 生成所有的标签且以 | 分割，修改时只需要修改 join(&quot; | &quot;) 里面的内容。</span><br><span class="line">dv.paragraph(</span><br><span class="line">  dv.pages(&quot;&quot;).file.tags.distinct().map(t =&gt; &#123;return `[$&#123;t&#125;]($&#123;t&#125;)`&#125;).array().join(&quot; | &quot;)</span><br><span class="line">)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p><img src="https://pic2.zhimg.com/80/v2-409842ee36188bff87c1a48ba5ea2239_720w.jpg"></p>
<h3 id="高级版"><a href="#高级版" class="headerlink" title="高级版"></a>高级版</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 基于文件夹聚类所有的标签。</span><br><span class="line">for (let group of dv.pages(&quot;&quot;).filter(p =&gt; p.file.folder != &quot;&quot;).groupBy(p =&gt; p.file.folder.split(&quot;/&quot;)[0])) &#123;</span><br><span class="line">  dv.paragraph(`## $&#123;group.key&#125;`);</span><br><span class="line">  dv.paragraph(</span><br><span class="line">    dv.pages(`&quot;$&#123;group.key&#125;&quot;`).file.tags.distinct().map(t =&gt; &#123;return `[$&#123;t&#125;]($&#123;t&#125;)`&#125;).array().sort().join(&quot; | &quot;));</span><br><span class="line">&#125;</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://pic2.zhimg.com/80/v2-3fe7e64309ae888ca0cac41635685929_720w.jpg"></p>
<h3 id="输出内容"><a href="#输出内容" class="headerlink" title="输出内容"></a>输出内容</h3><h3 id="输出所有带有关键词的行"><a href="#输出所有带有关键词的行" class="headerlink" title="输出所有带有关键词的行"></a>输出所有带有关键词的行</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">//使用时修改关键词即可</span><br><span class="line">const term = &quot;关键词&quot;</span><br><span class="line">const files = app.vault.getMarkdownFiles()</span><br><span class="line">const arr = files.map(async ( file) =&gt; &#123;</span><br><span class="line">const content = await app.vault.cachedRead(file)</span><br><span class="line">const lines = content.split(&quot;\n&quot;).filter(line =&gt; line.contains(term))</span><br><span class="line">return lines</span><br><span class="line">&#125;)</span><br><span class="line">Promise.all(arr).then(values =&gt; </span><br><span class="line">dv.list(values.flat()))</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p>如下：</p>
<p><img src="https://pic3.zhimg.com/80/v2-ce72d265ebc2d61306622dce0e984e62_720w.jpg"></p>
<h3 id="输出所有带有标签的文件名以及对应行且形成表格"><a href="#输出所有带有标签的文件名以及对应行且形成表格" class="headerlink" title="输出所有带有标签的文件名以及对应行且形成表格"></a>输出所有带有标签的文件名以及对应行且形成表格</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 修改标签</span><br><span class="line">const tag = &quot;#active&quot;</span><br><span class="line">// 获取 Obsidian 中的所有 Markdown 文件</span><br><span class="line">const files = app.vault.getMarkdownFiles()</span><br><span class="line">// 将带有标签的文件筛选出来</span><br><span class="line">const taggedFiles = new Set(files.reduce((acc, file) =&gt; &#123;</span><br><span class="line">    const tags = app.metadataCache.getFileCache(file).tags</span><br><span class="line">    if (tags) &#123;</span><br><span class="line">      let filtered = tags.filter(t =&gt; t.tag === tag)</span><br><span class="line">      if (filtered) &#123;</span><br><span class="line">        return [...acc, file]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return acc</span><br><span class="line">&#125;, []))</span><br><span class="line"></span><br><span class="line">// 创建带有标签的行数组</span><br><span class="line">const arr = Array.from(taggedFiles).map(async(file) =&gt; &#123;</span><br><span class="line">  const content = await app.vault.cachedRead(file)</span><br><span class="line">const lines = await content.split(&quot;\n&quot;).filter(line =&gt; line.includes(tag))</span><br><span class="line">return [file.name, lines]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 生成表格</span><br><span class="line">Promise.all(arr).then(values =&gt; &#123;</span><br><span class="line">dv.table([&quot;file&quot;, &quot;lines&quot;], values)</span><br><span class="line">&#125;)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="输出所有带有标签的文件链接以及对应行且形成表格"><a href="#输出所有带有标签的文件链接以及对应行且形成表格" class="headerlink" title="输出所有带有标签的文件链接以及对应行且形成表格"></a>输出所有带有标签的文件链接以及对应行且形成表格</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 获取 Obsidian 中的所有 Markdown 文件</span><br><span class="line">const files = app.vault.getMarkdownFiles()</span><br><span class="line"></span><br><span class="line">// 将带有标签的文件以及行筛选出来</span><br><span class="line">let arr = files.map(async(file) =&gt; &#123;</span><br><span class="line">  const content = await app.vault.cachedRead(file)</span><br><span class="line">//turn all the content into an array</span><br><span class="line">let lines = await content.split(&quot;\n&quot;).filter(line =&gt; line.includes(&quot;#tag&quot;))</span><br><span class="line">return [&quot;[[&quot;+file.name.split(&quot;.&quot;)[0]+&quot;]]&quot;, lines]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 生成表格，如果要将当前的文件排除的话，请修改其中的排除文件</span><br><span class="line">Promise.all(arr).then(values =&gt; &#123;</span><br><span class="line">console.log(values)</span><br><span class="line">//filter out files without &quot;Happy&quot; and the note with the dataview script</span><br><span class="line">const exists = values.filter(value =&gt; value[1][0] &amp;&amp; value[0] != &quot;[[排除文件]]&quot;)</span><br><span class="line">dv.table([&quot;file&quot;, &quot;lines&quot;], exists)</span><br><span class="line">&#125;)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p>如下：</p>
<p><img src="https://pic2.zhimg.com/80/v2-1abe55c9291d239d66cc0d1a08aab9c1_720w.jpg"></p>
<h3 id="输出任务"><a href="#输出任务" class="headerlink" title="输出任务"></a>输出任务</h3><h3 id="简单版-1"><a href="#简单版-1" class="headerlink" title="简单版"></a>简单版</h3><p>输出所有带有标签 todo 以及未完成的任务</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 修改其中的标签 todo </span><br><span class="line">dv.taskList(</span><br><span class="line">    dv.pages(&quot;&quot;).file.tasks</span><br><span class="line">    .where(t =&gt; t.text.includes(&quot;#todo&quot;) &amp;&amp; !t.completed),1)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="改进版-1"><a href="#改进版-1" class="headerlink" title="改进版"></a>改进版</h3><p>输出所有带有标签 todo 以及未完成的任务，且不包含当前文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 修改其中的标签 todo 以及修改 LOLOLO</span><br><span class="line">dv.taskList(</span><br><span class="line">    dv.pages(&quot;&quot;).where(t =&gt; &#123; return t.file.name != &quot;LOLOLO&quot; &#125;).file.tasks</span><br><span class="line">    .where(t =&gt; t.text.includes(&quot;#todo&quot;) &amp;&amp; !t.completed),1)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h3 id="倒计时"><a href="#倒计时" class="headerlink" title="倒计时"></a>倒计时</h3><h3 id="简单版-2"><a href="#简单版-2" class="headerlink" title="简单版"></a>简单版</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 修改其中的时间，可以输出当前离倒计时的时间差。</span><br><span class="line">const setTime = new Date(&quot;2021/8/15 08:00:00&quot;);</span><br><span class="line">const nowTime = new Date();</span><br><span class="line">const restSec = setTime.getTime() - nowTime.getTime();</span><br><span class="line">const day = parseInt(restSec / (60*60*24*1000));</span><br><span class="line"></span><br><span class="line">const str = day + &quot;天&quot;</span><br><span class="line"></span><br><span class="line">dv.paragraph(str);</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<p>如下：</p>
<p><img src="https://pic3.zhimg.com/80/v2-9b8aded0822c91d2ed478ac952e0c236_720w.png"></p>
<h3 id="复杂版"><a href="#复杂版" class="headerlink" title="复杂版"></a>复杂版</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">​```dataviewjs</span><br><span class="line">// 只要在任务后边加上时间（格式为 2020-01-01 ，就会在显示所有的任务的同时对应生成对应的倒计时之差</span><br><span class="line">dv.paragraph(</span><br><span class="line">  dv.pages(&quot;&quot;).file.tasks.array().map(t =&gt; &#123;</span><br><span class="line">   const reg = /\d&#123;4&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;/;</span><br><span class="line"> var d = t.text.match(reg);</span><br><span class="line"> if (d != null) &#123;</span><br><span class="line">   var date = Date.parse(d);</span><br><span class="line">   return `- $&#123;t.text&#125; -- $&#123;Math.round((date - Date.now()) / 86400000)&#125;天`</span><br><span class="line"> &#125;;</span><br><span class="line"> return `- $&#123;t.text&#125;`;</span><br><span class="line">  &#125;).join(&quot;\n&quot;)</span><br><span class="line">)</span><br><span class="line">​```</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/373623264">Obsidian 插件之 Dataview - 知乎</a></li>
<li><a target="_blank" rel="noopener" href="https://blacksmithgu.github.io/obsidian-dataview/api/code-reference/#render">Codeblock Reference - Dataview</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2022/02/26/zinit-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/26/zinit-introduction/" class="post-title-link" itemprop="url">Zinit 介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-02-26 17:04:00" itemprop="dateCreated datePublished" datetime="2022-02-26T17:04:00+08:00">2022-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-27 16:02:00" itemprop="dateModified" datetime="2022-02-27T16:02:00+08:00">2022-02-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Zinit-介绍"><a href="#Zinit-介绍" class="headerlink" title="Zinit 介绍"></a>Zinit 介绍</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>一个为ZSH设计的插件管理框架，主要特性是轻量，支持延迟加载插件，避免ZSH启动时响应缓慢</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h3><ul>
<li>下载源代码仓库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZINIT_HOME=&quot;$&#123;XDG_DATA_HOME:-$&#123;HOME&#125;/.local/share&#125;/zinit/zinit.git&quot;</span><br><span class="line">mkdir -p &quot;$(dirname $ZINIT_HOME)&quot;</span><br><span class="line">git clone https://github.com/zdharma-continuum/zinit.git &quot;$ZINIT_HOME&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>注册Zinit到<code>.zshrc</code>，添加这两行，完成基础配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZINIT_HOME=&quot;$&#123;XDG_DATA_HOME:-$&#123;HOME&#125;/.local/share&#125;/zinit/zinit.git&quot;</span><br><span class="line">source &quot;$&#123;ZINIT_HOME&#125;/zinit.zsh&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>（可选）（执行 <code>.zshrc</code>，启动Zinit</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<ul>
<li>（可选）（运行Zinit自动更新，让Zinit自行完成剩余配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zinit self-update</span><br></pre></td></tr></table></figure>

<h2 id="添加插件"><a href="#添加插件" class="headerlink" title="添加插件"></a>添加插件</h2><p>插件安装来源为github任意仓库，指定<code>用户名/仓库名</code>即可，将命令放入zshrc即可配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zinit load  &lt;repo/plugin&gt; # Load with reporting/investigating.</span><br><span class="line">zinit light &lt;repo/plugin&gt; # Load without reporting/investigating.</span><br><span class="line">zinit snippet &lt;URL&gt; # Install direct script file, support local file</span><br></pre></td></tr></table></figure>

<h3 id="OhMyZSH插件"><a href="#OhMyZSH插件" class="headerlink" title="OhMyZSH插件"></a>OhMyZSH插件</h3><p>对于 [[OhMyZSH]] 和 Prezto，还可以使用缩写 <code>OMZ::</code> 和 <code>PZT::</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zinit snippet OMZ::plugins/git/git.plugin.zsh</span><br><span class="line">zinit snippet PZT::modules/helper/init.zsh</span><br></pre></td></tr></table></figure>

<h2 id="常用配置插件"><a href="#常用配置插件" class="headerlink" title="常用配置插件"></a>常用配置插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Theme</span></span><br><span class="line">zinit ice depth&quot;1&quot; # git clone depth</span><br><span class="line">zinit light romkatv/powerlevel10k </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">快速目录跳转</span> </span><br><span class="line">zinit ice lucid wait=&#x27;1&#x27; </span><br><span class="line">zinit light skywind3000/z.lua</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法高亮</span> </span><br><span class="line">zinit ice lucid wait=&#x27;0&#x27; atinit=&#x27;zpcompinit&#x27; </span><br><span class="line">zinit light zdharma/fast-syntax-highlighting </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">自动建议</span> </span><br><span class="line">zinit ice lucid wait=&quot;0&quot; atload=&#x27;_zsh_autosuggest_start&#x27; </span><br><span class="line">zinit light zsh-users/zsh-autosuggestions</span><br><span class="line"></span><br><span class="line">zinit load zdharma-continuum/history-search-multi-word</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载 OMZ 框架及部分插件</span> </span><br><span class="line">zinit snippet OMZ::lib/completion.zsh </span><br><span class="line">zinit snippet OMZ::lib/history.zsh </span><br><span class="line">zinit snippet OMZ::lib/key-bindings.zsh </span><br><span class="line">zinit snippet OMZ::lib/theme-and-appearance.zsh </span><br><span class="line">zinit snippet OMZ::plugins/colored-man-pages/colored-man-pages.plugin.zsh </span><br><span class="line">zinit snippet OMZ::plugins/sudo/sudo.plugin.zsh</span><br><span class="line"></span><br><span class="line">zinit ice lucid wait=&#x27;1&#x27; </span><br><span class="line">zinit snippet OMZ::plugins/git/git.plugin.zsh</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/zdharma-continuum/zinit">GitHub - zdharma-continuum&#x2F;zinit: 🌻 Flexible and fast ZSH plugin manager</a></li>
<li><a target="_blank" rel="noopener" href="https://www.aloxaf.com/2019/11/zplugin_tutorial/">加速你的 zsh —— 最强 zsh 插件管理器 zplugin&#x2F;zinit 教程 - Aloxaf’s Blog</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2020/03/21/c-use-priority-queue-with-custom-compare-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/21/c-use-priority-queue-with-custom-compare-function/" class="post-title-link" itemprop="url">C++ 使用带自定义比较函数的优先队列</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-21 16:13:08" itemprop="dateCreated datePublished" datetime="2020-03-21T16:13:08+08:00">2020-03-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="C-使用带自定义比较函数的优先队列"><a href="#C-使用带自定义比较函数的优先队列" class="headerlink" title="C++ 使用带自定义比较函数的优先队列"></a>C++ 使用带自定义比较函数的优先队列</h1><h2 id="优先队列-priority-queue"><a href="#优先队列-priority-queue" class="headerlink" title="优先队列 priority_queue"></a>优先队列 priority_queue</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>C++中自动保持有序的队列，位于 queue 头文件中，能够以 O(logn) 的复杂度取得 n 个元素中的最小元素，不需要自行实现堆排序。此队列默认为大顶堆，可以通过自定义来实现小顶堆。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;int&gt; data; // 储存 int 型的从大到小优先队列</span><br><span class="line"></span><br><span class="line">queue&lt;int, vector&lt;int&gt;, less&lt;int&gt;&gt; data; // 储存 int 型的从大到小优先队列的等价写法</span><br><span class="line"></span><br><span class="line">queue&lt;int, vector&lt;int&gt;, greater&lt;int&gt;&gt; data; // 储存 int 型的从小到大优先队列</span><br></pre></td></tr></table></figure>

<h4 id="成员函数"><a href="#成员函数" class="headerlink" title="成员函数"></a>成员函数</h4><p>参考 <a target="_blank" rel="noopener" href="https://www.cplusplus.com/reference/queue/priority_queue/">https://www.cplusplus.com/reference/queue/priority_queue/</a></p>
<h4 id="自定义类型时的比较设定"><a href="#自定义类型时的比较设定" class="headerlink" title="自定义类型时的比较设定"></a>自定义类型时的比较设定</h4><p>由于 less&lt;&gt; 与 greater&lt;&gt; 仅支持系统自带的类型，这里有两种方法可以支持自定义类型的比较</p>
<ul>
<li>重载 struct 的 operator &lt;（即重载小于号实现比较，因为内部的排序仅使用小于号比较），来为 less&lt;&gt; 与 greater&lt;&gt; 扩展比较能力</li>
<li>传入自定义的 cmp 函数（更准确的说是重载了()操作符的数据结构，因为此处是使用泛型传入的），来完全自定义比较过程</li>
</ul>
<h2 id="struct-重载运算符"><a href="#struct-重载运算符" class="headerlink" title="struct 重载运算符"></a>struct 重载运算符</h2><h3 id="重载语法"><a href="#重载语法" class="headerlink" title="重载语法"></a>重载语法</h3><p>重载小于号例子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">struct node&#123;</span><br><span class="line">	int data;</span><br><span class="line">	int test;</span><br><span class="line">	bool operator &lt; (const node &amp;b) const &#123;</span><br><span class="line">		return data &lt; b.data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;node, vector&lt;node&gt;, greater&lt;node&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="自定义-cmp-函数"><a href="#自定义-cmp-函数" class="headerlink" title="自定义 cmp 函数"></a>自定义 cmp 函数</h2><p>当涉及到指针类型时只能通过这种方法</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct cmp&#123;</span><br><span class="line">	bool operator() (node* a, node* b)&#123;</span><br><span class="line">		return a-&gt;data &lt; b-&gt;data;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">priority_queue&lt;node*, vector&lt;node*&gt;, cmp&gt; data;</span><br></pre></td></tr></table></figure>


<h2 id="完整总结例子"><a href="#完整总结例子" class="headerlink" title="完整总结例子"></a>完整总结例子</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;queue&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">struct node&#123;</span><br><span class="line">	int data;</span><br><span class="line">	int test;</span><br><span class="line">	bool operator &lt; (const node &amp;b) const &#123;</span><br><span class="line">		return data &lt; b.data;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	node(int d)&#123;data = d;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct cmp&#123;</span><br><span class="line">	bool operator() (node* a, node* b)&#123;</span><br><span class="line">		return *a &lt; *b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">	priority_queue&lt;node*, vector&lt;node*&gt;, cmp&gt; data;</span><br><span class="line">	node* new_node;</span><br><span class="line">	</span><br><span class="line">	int input, count;</span><br><span class="line">	cin &gt;&gt; count;</span><br><span class="line">	for(int i = 0; i &lt; count; i++)&#123;</span><br><span class="line">		cin &gt;&gt; input;</span><br><span class="line">		new_node = new node(input);</span><br><span class="line">		data.push(new_node);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node* input1;</span><br><span class="line">	node* input2;</span><br><span class="line">	while(data.size() &gt; 1)&#123;</span><br><span class="line">		input1 = data.top();</span><br><span class="line">		data.pop();</span><br><span class="line">		input2 = data.top();</span><br><span class="line">		data.pop();</span><br><span class="line">		input1-&gt;data = input1-&gt;data +  input2-&gt;data;</span><br><span class="line">		delete input2;</span><br><span class="line">		data.push(input1);</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; data.top()-&gt;data &lt;&lt; endl;</span><br><span class="line">	new_node = data.top();</span><br><span class="line">	data.pop();</span><br><span class="line">	delete new_node;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2020/01/27/python-urllib3-support-proxy-with-dns-resolve/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/27/python-urllib3-support-proxy-with-dns-resolve/" class="post-title-link" itemprop="url">Urllib 通过 socks 协议解析 DNS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-27 21:41:44" itemprop="dateCreated datePublished" datetime="2020-01-27T21:41:44+08:00">2020-01-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>socks 协议是支持进行 DNS 解析的，但是很多使用该协议的程序并没有实现从 socks 协议来解析域名，仅仅是将流量转发到了 socks 端口上。</p>
<p>今天在使用 python 的 urllib 的时候意外地发现 urllib 是支持设定从 socks 协议进行解析的，具体的 PR 在 <a target="_blank" rel="noopener" href="https://github.com/urllib3/urllib3/pull/1036">https://github.com/urllib3/urllib3/pull/1036</a></p>
<p>在设定 proxy 时将协议头设置为 socks5h 即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="cn">
    <link itemprop="mainEntityOfPage" href="https://blog.swordandfire.online/2020/01/17/use-supervisor-to-manage-your-service-in-WSL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Icear">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Icear's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/17/use-supervisor-to-manage-your-service-in-WSL/" class="post-title-link" itemprop="url">使用 supervisor 来管理 WSL 上的服务并实现开机自启动</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-17 17:46:53" itemprop="dateCreated datePublished" datetime="2020-01-17T17:46:53+08:00">2020-01-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>WSL 是 Windows 下的 Linux 子系统，通过兼容层实现在 Windows 平台上模拟 Linux 环境，不像 WSL2 拥有完整的 Linux 内核。这使得很多依赖内核机制的应用都无法使用，比如说 system-init 和 docker。没有 system-init 支持之后常用的服务管理工具 systemctl 也就失效了，虽然可以通过 service 命令来操作，但是遇到需要自定义服务的时候，service 就显得有些简陋了：需要手写较长的脚本配置外加不支持自动重启等。此时就需要 supervisor 了，基于子进程的服务管理方式不需要内核支持，能够在 WSL 环境很好的工作</p>
<h2 id="相关细节"><a href="#相关细节" class="headerlink" title="相关细节"></a>相关细节</h2><p>supervisor 可以通过系统自带包管理器安装，又因为是 python 编写，支持通过 pip 安装。但是两者安装的版本上有一些区别。</p>
<ul>
<li>通过包管理器安装的 supervisor 会向 &#x2F;etc&#x2F;init.d 目录释放用于 service 命令管理的配置文件（其实就是个脚本文件，所以说有点麻烦写），但是它安装的 supervisor 所依赖的 python 版本会根据当前系统的初始版本变化。比如我这里使用的是 Ubuntu 系统，系统默认为 python2 ，虽然我已经手动切换到了 python 3，但是所安装的 supervisor 依然是基于 python2 版本（这个依赖应该是由 Ubuntu 的包所决定的，大概制作包的时候就是以 python2 为基准制作的吧，并没有根据环境自动选择），于是在安装 python2 版本的 supervisor 而运行环境为 python3 时，运行 supervisor 就会出现如下错误，找不到对应包：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/bin/supervisord&quot;, line 6, in &lt;module&gt;</span><br><span class="line">    from pkg_resources import load_entry_point</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 3088, in &lt;module&gt;</span><br><span class="line">    @_call_aside</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 3072, in _call_aside</span><br><span class="line">    f(*args, **kwargs)</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 3101, in _initialize_master_working_set</span><br><span class="line">    working_set = WorkingSet._build_master()</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 574, in _build_master</span><br><span class="line">    ws.require(__requires__)</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 892, in require</span><br><span class="line">    needed = self.resolve(parse_requirements(requirements))</span><br><span class="line">  File &quot;/usr/lib/python3/dist-packages/pkg_resources/__init__.py&quot;, line 778, in resolve</span><br><span class="line">    raise DistributionNotFound(req, requirers)</span><br><span class="line">pkg_resources.DistributionNotFound: The &#x27;supervisor==3.3.1&#x27; distribution was not found and is required by the application</span><br></pre></td></tr></table></figure></li>
<li>通过 pip 安装的 supervisor 能够正常匹配所使用的 python 版本<del>（废话）</del>，但是<ul>
<li>使用当前用户安装时程序会被放置到家目录的 .local&#x2F;lib&#x2F;python*&#x2F;site-packages&#x2F; 目录下，虽然能够调用但是不是常规位置，不便于管理</li>
<li>使用 sudo 或 root 权限安装时会安装到 &#x2F;usr&#x2F;local&#x2F;lib&#x2F; 目录下，可执行文件在 &#x2F;usr&#x2F;local&#x2F;bin&#x2F; 目录中，比较正常</li>
</ul>
</li>
</ul>
<h2 id="最终方案"><a href="#最终方案" class="headerlink" title="最终方案"></a>最终方案</h2><p>配置安装 supervisor 并使其支持通过 service 命令控制启停，然后在 Windows 下设置开机时启动 supervisor 进行，借此启动注册在 supervisor 下的各种服务</p>
<ul>
<li>使用默认 python 版本的话可以直接从包管理器安装 supervisor，之后通过以下命令来启动进程，相关配置文件在 &#x2F;etc&#x2F;supervisor&#x2F; 下  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service supervisor start</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h2><h3 id="安装-supervisor-并配置"><a href="#安装-supervisor-并配置" class="headerlink" title="安装 supervisor 并配置"></a>安装 supervisor 并配置</h3><ul>
<li>使用 python3 但系统默认版本为 python2 的情况，使用 pip 进行全局安装，但配置文件使用包管理器自带版本，即 &#x2F;etc&#x2F;init.d&#x2F; 目录下相关服务管理脚本与 &#x2F;etc&#x2F;supervisor&#x2F; 配置文件目录。这里为了部署方便我会直接贴出从包管理器安装版本提取的服务管理脚本以及 supervisor 配置文件。以下为部署步骤：<ul>
<li>使用 pip 全局安装 supervisor   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install supervisor</span><br></pre></td></tr></table></figure></li>
<li>创建服务管理脚本  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/init.d/supervisor</span><br></pre></td></tr></table></figure>
  以下为脚本内容，已修改程序路径  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line">#</span><br><span class="line"># skeleton      example file to build /etc/init.d/ scripts.</span><br><span class="line">#               This file should be used to construct scripts for /etc/init.d.</span><br><span class="line">#</span><br><span class="line">#               Written by Miquel van Smoorenburg &lt;miquels@cistron.nl&gt;.</span><br><span class="line">#               Modified for Debian</span><br><span class="line">#               by Ian Murdock &lt;imurdock@gnu.ai.mit.edu&gt;.</span><br><span class="line">#               Further changes by Javier Fernandez-Sanguino &lt;jfs@debian.org&gt;</span><br><span class="line">#</span><br><span class="line"># Version:      @(#)skeleton  1.9  26-Feb-2001  miquels@cistron.nl</span><br><span class="line">#</span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:          supervisor</span><br><span class="line"># Required-Start:    $remote_fs $network $named</span><br><span class="line"># Required-Stop:     $remote_fs $network $named</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      0 1 6</span><br><span class="line"># Short-Description: Start/stop supervisor</span><br><span class="line"># Description:       Start/stop supervisor daemon and its configured</span><br><span class="line">#                    subprocesses.</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">DAEMON=/usr/local/bin/supervisord</span><br><span class="line">NAME=supervisord</span><br><span class="line">DESC=supervisor</span><br><span class="line"></span><br><span class="line">test -x $DAEMON || exit 0</span><br><span class="line"></span><br><span class="line">RETRY=TERM/30/KILL/5</span><br><span class="line">LOGDIR=/var/log/supervisor</span><br><span class="line">PIDFILE=/var/run/$NAME.pid</span><br><span class="line">DODTIME=5                   # Time to wait for the server to die, in seconds</span><br><span class="line">                            # If this value is set too low you might not</span><br><span class="line">                            # let some servers to die gracefully and</span><br><span class="line">                            # &#x27;restart&#x27; will not work</span><br><span class="line"></span><br><span class="line"># Include supervisor defaults if available</span><br><span class="line">if [ -f /etc/default/supervisor ] ; then</span><br><span class="line">        . /etc/default/supervisor</span><br><span class="line">fi</span><br><span class="line">DAEMON_OPTS=&quot;-c /etc/supervisor/supervisord.conf $DAEMON_OPTS&quot;</span><br><span class="line"></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">running_pid()</span><br><span class="line">&#123;</span><br><span class="line">    # Check if a given process pid&#x27;s cmdline matches a given name</span><br><span class="line">    pid=$1</span><br><span class="line">    name=$2</span><br><span class="line">    [ -z &quot;$pid&quot; ] &amp;&amp; return 1</span><br><span class="line">    [ ! -d /proc/$pid ] &amp;&amp;  return 1</span><br><span class="line">    (cat /proc/$pid/cmdline | tr &quot;\000&quot; &quot;\n&quot;|grep -q $name) || return 1</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">running()</span><br><span class="line">&#123;</span><br><span class="line"># Check if the process is running looking at /proc</span><br><span class="line"># (works for all users)</span><br><span class="line"></span><br><span class="line">    # No pidfile, probably no daemon present</span><br><span class="line">    [ ! -f &quot;$PIDFILE&quot; ] &amp;&amp; return 1</span><br><span class="line">    # Obtain the pid and check it against the binary name</span><br><span class="line">    pid=`cat $PIDFILE`</span><br><span class="line">    running_pid $pid $DAEMON || return 1</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">start)</span><br><span class="line">        echo -n &quot;Starting $DESC: &quot;</span><br><span class="line">        start-stop-daemon --start --quiet --pidfile $PIDFILE \</span><br><span class="line">                --startas $DAEMON -- $DAEMON_OPTS</span><br><span class="line">        test -f $PIDFILE || sleep 1</span><br><span class="line">        if running ; then</span><br><span class="line">            echo &quot;$NAME.&quot;</span><br><span class="line">        else</span><br><span class="line">            echo &quot; ERROR.&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line">stop)</span><br><span class="line">        echo -n &quot;Stopping $DESC: &quot;</span><br><span class="line">        # [ -f $PIDFILE ] &amp;&amp; killproc $prog || success $&quot;$prog shutdown&quot;</span><br><span class="line">        start-stop-daemon --stop --quiet --oknodo --pidfile $PIDFILE</span><br><span class="line">        echo &quot;$NAME.&quot;</span><br><span class="line">        ;;</span><br><span class="line">#reload)</span><br><span class="line">        #</span><br><span class="line">        #       If the daemon can reload its config files on the fly</span><br><span class="line">        #       for example by sending it SIGHUP, do it here.</span><br><span class="line">        #</span><br><span class="line">        #       If the daemon responds to changes in its config file</span><br><span class="line">        #       directly anyway, make this a do-nothing entry.</span><br><span class="line">        #</span><br><span class="line">        # echo &quot;Reloading $DESC configuration files.&quot;</span><br><span class="line">        # start-stop-daemon --stop --signal 1 --quiet --pidfile \</span><br><span class="line">        #       /var/run/$NAME.pid --exec $DAEMON</span><br><span class="line">#;;</span><br><span class="line">force-reload)</span><br><span class="line">        #</span><br><span class="line">        #       If the &quot;reload&quot; option is implemented, move the &quot;force-reload&quot;</span><br><span class="line">        #       option to the &quot;reload&quot; entry above. If not, &quot;force-reload&quot; is</span><br><span class="line">        #       just the same as &quot;restart&quot; except that it does nothing if the</span><br><span class="line">        #   daemon isn&#x27;t already running.</span><br><span class="line">        # check wether $DAEMON is running. If so, restart</span><br><span class="line">        start-stop-daemon --stop --test --quiet --pidfile $PIDFILE \</span><br><span class="line">        --startas $DAEMON \</span><br><span class="line">        &amp;&amp; $0 restart \</span><br><span class="line">        || exit 0</span><br><span class="line">        ;;</span><br><span class="line">restart)</span><br><span class="line">    echo -n &quot;Restarting $DESC: &quot;</span><br><span class="line">    start-stop-daemon --stop --retry=$RETRY --quiet --oknodo --pidfile $PIDFILE</span><br><span class="line">        echo &quot;$NAME.&quot;</span><br><span class="line">        ;;</span><br><span class="line">status)</span><br><span class="line">    echo -n &quot;$NAME is &quot;</span><br><span class="line">    if running ;  then</span><br><span class="line">        echo &quot;running&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot; not running.&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">        N=/etc/init.d/$NAME</span><br><span class="line">        # echo &quot;Usage: $N &#123;start|stop|restart|reload|force-reload&#125;&quot; &gt;&amp;2</span><br><span class="line">        echo &quot;Usage: $N &#123;start|stop|restart|force-reload|status&#125;&quot; &gt;&amp;2</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure></li>
<li>创建配置目录  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/supervisor</span><br><span class="line">sudo mkdir /etc/supervisor/conf.d</span><br><span class="line">sudo vi /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure>
  以下为脚本内容  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">; supervisor config file</span><br><span class="line"></span><br><span class="line">[unix_http_server]</span><br><span class="line">file=/var/run/supervisor.sock   ; (the path to the socket file)</span><br><span class="line">chmod=0700                       ; sockef file mode (default 0700)</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)</span><br><span class="line">pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span><br><span class="line">childlogdir=/var/log/supervisor            ; (&#x27;AUTO&#x27; child log dir, default $TEMP)</span><br><span class="line"></span><br><span class="line">; the below section must remain in the config file for RPC</span><br><span class="line">; (supervisorctl/web interface) to work, additional interfaces may be</span><br><span class="line">; added by defining them in separate rpcinterface: sections</span><br><span class="line">[rpcinterface:supervisor]</span><br><span class="line">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class="line"></span><br><span class="line">; The [include] section can just contain the &quot;files&quot; setting.  This</span><br><span class="line">; setting can list multiple files (separated by whitespace or</span><br><span class="line">; newlines).  It can also contain wildcards.  The filenames are</span><br><span class="line">; interpreted as relative to this file.  Included files *cannot*</span><br><span class="line">; include files themselves.</span><br><span class="line"></span><br><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/conf.d/*.conf</span><br></pre></td></tr></table></figure></li>
<li>至此配置结束，启动服务的命令为 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service supervisor start</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="设置自启动"><a href="#设置自启动" class="headerlink" title="设置自启动"></a>设置自启动</h3><ul>
<li>使用 Windows + R 快捷键调出运行窗口，输入   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell:startup</span><br></pre></td></tr></table></figure></li>
<li>在弹出的文件目录下创建一个快捷方式，名称任意，其执行命令设为   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\wsl.exe -u root service supervisor start</span><br></pre></td></tr></table></figure></li>
</ul>
<p>至此所有的操作就完成了，向 supervisor 配置的各种服务也能够正常运作，具体的配置方式可以查阅官方文档。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Icear</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/icear" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;icear" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Icear</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
